---
title: "Untitled"
output: html_document
date: "2022-12-05"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Read In Data Set

```{r}
library(readr)
library(tidyverse)
library(skimr)
disney <- read_csv("/Users/christinalopez/Desktop/STAT471_F22/datasets/disney/disney_movies_total_gross.csv")
```

```{r}
skim_without_charts(disney)
```

# Data Cleaning

```{r}
library(dplyr)

disney2 <- disney |>
  mutate(genre = factor(genre), 
         rating = factor(MPAA_rating, levels = c("G", "PG", "PG-13", "R")), 
         gross = parse_number(inflation_adjusted_gross),
         release_date = as.Date(release_date, format = "%b %d, %Y"),
         release_year = as.numeric(format(release_date, "%Y")),
         gross_million = round(gross/1000000, digits = 1),
         gross_K = round(gross/1000, digits =3)) |>
  select(-total_gross, -inflation_adjusted_gross, -MPAA_rating ) |>
  drop_na()
```

# Exporatory Data Analysis

## Skim 
```{r}
skim_without_charts(disney2)
```

## Ratings

```{r}

colors = c("thistle3", "thistle4", "rosybrown3", "rosybrown4")

disney2 |>
  group_by(rating) |>
  summarize(n = n()) |>
  ggplot(aes(x = reorder(rating, -n), y = n)) + 
  geom_col(aes(fill = reorder(rating,n)), color = "black", size = 0.2) +   
  scale_fill_manual(values = colors) +
  ggtitle("Top ratings")+ labs(x = "count", y = "Rating") + 
  theme_minimal() + theme(legend.position = "none")


```

## Genres (pink pallet)

```{r}
colors4 = c("thistle4", "thistle3", "rosybrown4", "rosybrown3", "lightpink4", "lightpink3")

disney2 |>
  select(genre) |>
  group_by(genre) |>
  summarise(n = n()) |>
  head(6) |>
  ggplot(aes(x = reorder(genre, n), y = n)) + 
  geom_col(aes(fill = reorder(genre, -n)), color = "black", size = .2) +
  scale_fill_manual(values = colors4) + coord_flip() + 
  ggtitle("Top genres") + labs(x = "Genre", y = "Count") + 
  theme_minimal() + theme(legend.position = "none")

```


## Movie Count Per Year 

```{r}
disney2 |>
  select(release_year) |>
  filter(release_year >= 1991) |>
  group_by(release_year) |>
  summarise(n = n()) |>
  ggplot(aes(x = release_year, y = n)) + 
  geom_col(fill = "thistle3", color = "black", size = 0.2)+ 
  ggtitle("Movie Count Per Year") + 
  theme_minimal() + labs(x = "Release Year", y = "Count")
```

# Model release year on gross

## Plot the model

```{r}
disney2 |>
  mutate(release_year = as.numeric(release_year)) |>
  ggplot(aes(x = release_year, y = gross_K)) +
  geom_point() + 
  geom_smooth(method = "lm", se = FALSE, color = "blue")
```

## Subset data 

```{r}
disney3 <- disney2 |>
  filter(release_year >= 1990) |>
  mutate(release_year = as.numeric(release_year))
```

```{r}
ggplot(disney3, aes(x = release_year, y = gross_million)) +
  geom_point(shape = 21, colour = 'black', fill = 'white') +
  labs(x = 'Release Year', y = '$ Gross Million') +
  geom_smooth(method='lm', se=FALSE, aes(color = genre)) +
  ggtitle('$ Gross Million vs Release Year') +
  theme_bw()
```

```{r}
genres = c("Action", "Adventure")
disney4 <- disney3 |>
  filter(genre %in% genres )
```

```{r}
ggplot(disney4, aes(x = release_year, y = gross_million)) +
  geom_point(shape = 21, aes(colour = genre), fill = 'white') +
  labs(x = 'Release Year', y = '$ Gross Million') +
  geom_smooth(method='lm', se=FALSE, aes(color = genre)) +
  ggtitle('$ Gross Million vs Release Year') +
  theme_bw()
```

## Build a model 

```{r}
mod <- disney2 |>
  lm(formula = gross ~ release_year)
summary(mod)

```

```{r}
mod2 <- 
  disney2 |>
  lm(formula = gross ~ genre + rating)

summary(mod2)
```

```{r}
mod3 <- 
  disney2 |>
  lm(formula = gross ~ release_year + genre + rating)

summary(mod3)
```


# Model year on total disney revenue

## Read in other data set 

```{r}
library(readr)
revenue <- read_csv("/Users/christinalopez/Desktop/STAT471_F22/datasets/disney/disney_revenue_1991-2016.csv")

revenue1 <- revenue |>
  mutate(Year = as.numeric(Year))
```


```{r}
disney4 <- disney2 |>
  mutate(Year = release_year)
disney4
```

## Yearly Summary

```{r}
movies.revenue <- disney4 |> inner_join(revenue, by = c("Year" = "Year")) 

yearly.summary <- movies.revenue |>
  group_by(Year, Total) |>
  summarize(movie_count = n()) |>
  rename(total_revenue = Total) |>
  ungroup()
```

## Histogram of revenue

```{r}
yearly.summary |>
  ggplot(aes(x = total_revenue)) +
  geom_histogram(bins = 15, fill = "thistle3", color = "black", size = 0.2)+ 
  ggtitle("Histogram of Yearly Revenue For Disney") + 
  theme_minimal() + labs(x = "Yearly Revenue", y = "Count")
```

## Histogram of movie count 

```{r}
yearly.summary |>
  ggplot(aes(x = movie_count)) +
  geom_histogram(bins = 15, fill = "thistle3", color = "black", size = 0.2)+ 
  ggtitle("Histogram of Yearly Movie Count") + 
  theme_minimal() + labs(x = "Yearly Movie Count", y = "Count")

```



```{r}
head(yearly.summary)

yearly.summary |>
  ggplot(aes(x = Year, y = total_revenue)) +
  geom_point(shape = 21, color = "black") + 
  geom_smooth(color = "thistle3", method = "lm", se = FALSE) + 
  theme_minimal()
```


```{r}
yearly.summary |>
  ggplot(aes(x = movie_count, y = total_revenue)) +
  geom_point(shape = 21, color = "black") + 
  geom_smooth(color = "thistle3", method = "lm", se = FALSE) + 
  theme_minimal()
```

```{r}
library(GGally)
yearly.summary |>
  mutate(movie_count = sqrt(movie_count)) |>
  ggpairs() + theme_minimal()
```
## Model regressing revenue on year

```{r}
mod4 <- yearly.summary |>
  lm(formula = total_revenue ~ Year)

summary(mod4)
```

## Add more variables to the model 

```{r}
movies.revenue2 <- movies.revenue |>
  mutate(action = ifelse(genre == "Action", 1, 0),
         adventure = ifelse(genre == "Adventure",1,0),
         musical = ifelse(genre == "Musical", 1, 0),
         drama = ifelse(genre == "Drama", 1, 0),
         comedy = ifelse(genre == "Comedy", 1, 0))

head(movies.revenue2)
```
## yearly summary with count of top genres

```{r}
yearly.summary2 <- movies.revenue2 |>
  group_by(Year, Total) |>
  summarize(movie_count = n(),
            action_count = sum(action),
            adventure = sum(adventure),
            musical = sum(musical),
            drama = sum(drama),
            comedy = sum(comedy)) |>
  rename(total_revenue = Total) |>
  ungroup()

head(yearly.summary2)
```

## model with count of top genres

```{r, message = FALSE, warning = FALSE}
yearly.summary2 |>
  ggpairs()
```

```{r}
mod4 <- yearly.summary2 |>
  lm(formula = total_revenue ~ drama + comedy + Year)

summary(mod4)
```



# Challenges 

- Translate gross revenue from a text variable to a numeric variable 
- We can't get a very high R^2 value with the variables we have in this data set






